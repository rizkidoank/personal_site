<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Rizki Rizki">
    <meta name="description" content="Flashback to several years ago when I was using Twitter and learn text mining. At that time, I used python to collects twitter statuses with specific keywords / terms defined and then stored all of those statuses to csv as dataset for text mining learning. In this article, I will share how to stream twitter statuses with python using tweepy module but in this article, I only print the status without store it to a file or database.">
    <meta name="keywords" content="blog,developer,personal,devops">

    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Stream Twitter Statuses with Tweepy"/>
<meta name="twitter:description" content="Flashback to several years ago when I was using Twitter and learn text mining. At that time, I used python to collects twitter statuses with specific keywords / terms defined and then stored all of those statuses to csv as dataset for text mining learning. In this article, I will share how to stream twitter statuses with python using tweepy module but in this article, I only print the status without store it to a file or database."/>

    <meta property="og:title" content="Stream Twitter Statuses with Tweepy" />
<meta property="og:description" content="Flashback to several years ago when I was using Twitter and learn text mining. At that time, I used python to collects twitter statuses with specific keywords / terms defined and then stored all of those statuses to csv as dataset for text mining learning. In this article, I will share how to stream twitter statuses with python using tweepy module but in this article, I only print the status without store it to a file or database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://rizkidoank.com/2018/12/15/stream-twitter-statuses-with-tweepy/" />
<meta property="article:published_time" content="2018-12-15T20:47:00+00:00" />
<meta property="article:modified_time" content="2018-12-15T20:47:00+00:00" />


    
      <base href="https://rizkidoank.com/2018/12/15/stream-twitter-statuses-with-tweepy/">
    
    <title>
  Stream Twitter Statuses with Tweepy · rizkidoank&#39;s Blog
</title>

    
      <link rel="canonical" href="https://rizkidoank.com/2018/12/15/stream-twitter-statuses-with-tweepy/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.3219ef62ae52679b7a9c19043171c3cd9f523628c2a65f3ef247ee18836bc90b.css" integrity="sha256-MhnvYq5SZ5t6nBkEMXHDzZ9SNijCpl8&#43;8kfuGINryQs=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    <link rel="icon" type="image/png" href="https://rizkidoank.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://rizkidoank.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.72.0" />
  </head>

  
  
  <body class="colorscheme-light"
        onload=""
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      rizkidoank&#39;s Blog
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://rizkidoank.com/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://rizkidoank.com/about/">About</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Stream Twitter Statuses with Tweepy</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2018-12-15T20:47:00Z'>
                December 15, 2018
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              4-minute read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="/tags/data-collection/">data-collection</a>
      <span class="separator">•</span>
    <a href="/tags/tutorial/">tutorial</a>
      <span class="separator">•</span>
    <a href="/tags/python/">python</a></div>

        </div>
      </header>

      <div>
        
        <p>Flashback to several years ago when I was using Twitter and learn text mining. At that time, I used python
to collects twitter statuses with specific keywords / terms defined and then stored all of those statuses
to csv as dataset for text mining learning. In this article, I will share how to stream twitter statuses
with python using tweepy module but in this article, I only print the status without store it to a file or
database.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Python 3, you might use Python 2. But I recommend to use Python 3 since Python 2 going to reach its EOL.</li>
<li><code>tweepy</code> module, install using <code>pip install tweepy</code></li>
<li>Twitter Apps key and tokens, create your in <a href="https://developer.twitter.com/en/apps">here</a></li>
</ul>
<h2 id="go-to-the-code">Go to the Code</h2>
<p>Here is my code to stream tweets in twitter:</p>
<pre><code class="language-pthon" data-lang="pthon">from tweepy.streaming import StreamListener
from tweepy import Stream
from tweepy import OAuthHandler
from tweepy import API
import os
import time

CONSUMER_KEY = os.environ['TWITTER_CONSUMER_KEY']
CONSUMER_SECRET = os.environ['TWITTER_CONSUMER_SECRET']
ACCESS_TOKEN = os.environ['TWITTER_ACCESS_TOKEN']
ACCESS_TOKEN_SECRET = os.environ['TWITTER_ACCESS_TOKEN_SECRET']
KEYWORDS = ['cianjur']


class TweetListener(StreamListener):
    def __init__(self, batch_size):
        super(TweetListener, self).__init__()
        self.tweets = []
        self.batch_size = batch_size
        self.count = 0

    def on_status(self, status):
        if status.retweeted or ('RT' in str(status.text).split(' ')):
            return
        self.tweets.append(status)
        if len(self.tweets) &gt;= self.batch_size:
            self.tweets = []
            print(&quot;sleep 5 secs&quot;)
            time.sleep(5)
        self.count = self.count + 1
        print(status.text)
        return True

    def on_error(self, status_code):
        if status_code == 420:
            print(&quot;Rate Limited&quot;)
            return False


def auth_twitter():
    auth = OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)
    auth.set_access_token(ACCESS_TOKEN, ACCESS_TOKEN_SECRET)
    return auth


if __name__ == '__main__':
    auth = auth_twitter()
    api = API(auth, wait_on_rate_limit=True)

    stream_listener = TweetListener(batch_size=10)
    stream = Stream(auth=api.auth, listener=stream_listener)

    stream.filter(track=KEYWORDS)
</code></pre><p>The code itself is quite simple and straightforward, let&rsquo;s move to next section for more
details.</p>
<h2 id="explanation">Explanation</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tweepy.streaming <span style="color:#f92672">import</span> StreamListener
<span style="color:#f92672">from</span> tweepy <span style="color:#f92672">import</span> Stream
<span style="color:#f92672">from</span> tweepy <span style="color:#f92672">import</span> OAuthHandler
<span style="color:#f92672">from</span> tweepy <span style="color:#f92672">import</span> API
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> time
</code></pre></div><p>First part are importing required modules to be used in the process. <code>StreamListener</code> is a listener that will
receives all messages routed by <code>Stream</code> established session. <code>OAuthHandler</code> used for authentication purpose.
The <code>API</code> is twitter API wrapper provided by <code>tweepy</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">CONSUMER_KEY <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;TWITTER_CONSUMER_KEY&#39;</span>]
CONSUMER_SECRET <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;TWITTER_CONSUMER_SECRET&#39;</span>]
ACCESS_TOKEN <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;TWITTER_ACCESS_TOKEN&#39;</span>]
ACCESS_TOKEN_SECRET <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;TWITTER_ACCESS_TOKEN_SECRET&#39;</span>]
KEYWORDS <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;cianjur&#39;</span>]
</code></pre></div><p>The next part are constants for the script, it&rsquo;s including twitter apps credentials and in this case, the stream
keywords. Please note that I retrieved the credentials from environment variables, so you need to <code>export</code> the variable
to your environment by <code>export TWITTER_xxx_xxx=content</code> for all vars.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TweetListener</span>(StreamListener):
    <span style="color:#66d9ef">def</span> __init__(self, batch_size):
        super(TweetListener, self)<span style="color:#f92672">.</span>__init__()
        self<span style="color:#f92672">.</span>tweets <span style="color:#f92672">=</span> []
        self<span style="color:#f92672">.</span>batch_size <span style="color:#f92672">=</span> batch_size
        self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_status</span>(self, status):
        <span style="color:#66d9ef">if</span> status<span style="color:#f92672">.</span>retweeted <span style="color:#f92672">or</span> (<span style="color:#e6db74">&#39;RT&#39;</span> <span style="color:#f92672">in</span> str(status<span style="color:#f92672">.</span>text)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)):
            <span style="color:#66d9ef">return</span>
        self<span style="color:#f92672">.</span>tweets<span style="color:#f92672">.</span>append(status)
        <span style="color:#66d9ef">if</span> len(self<span style="color:#f92672">.</span>tweets) <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>batch_size:
            self<span style="color:#f92672">.</span>tweets <span style="color:#f92672">=</span> []
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;sleep 5 secs&#34;</span>)
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">5</span>)
        self<span style="color:#f92672">.</span>count <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>count <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">print</span>(status<span style="color:#f92672">.</span>text)
        <span style="color:#66d9ef">return</span> True

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_error</span>(self, status_code):
        <span style="color:#66d9ef">if</span> status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">420</span>:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Rate Limited&#34;</span>)
            <span style="color:#66d9ef">return</span> False
</code></pre></div><p>This is the class that inherited from <code>StreamListener</code>. I created <code>__init__</code> method to add several class variable like
<code>tweets</code> to store list of tweet, <code>batch_size</code> to define maximum tweets stored in a batch. Batch useful if you&rsquo;re going
to pass the <code>tweets</code> to another stage, in example to messaging queue, it&rsquo;s actually not useful for this article, so you
might remove it if necessary. The last are <code>count</code> that will store number of tweets that already receives, useful if
you&rsquo;re going to limit tweets size.</p>
<p>Next is <code>on_status</code> in here, I basically only receive tweet that not a retweet status and print the content.
When tweets size limit the batch size, it will reset the list and sleep for five secs to prevent to many request in
specific window time there might be a better solution for this, lol.</p>
<p>The last is <code>on_error</code>, its basically just exit if the streamer got rate limited. For more response codes, go to
<a href="https://developer.twitter.com/en/docs/basics/response-codes.html">here</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth_twitter</span>():
    auth <span style="color:#f92672">=</span> OAuthHandler(CONSUMER_KEY, CONSUMER_SECRET)
    auth<span style="color:#f92672">.</span>set_access_token(ACCESS_TOKEN, ACCESS_TOKEN_SECRET)
    <span style="color:#66d9ef">return</span> auth


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    auth <span style="color:#f92672">=</span> auth_twitter()
    api <span style="color:#f92672">=</span> API(auth, wait_on_rate_limit<span style="color:#f92672">=</span>True)

    stream_listener <span style="color:#f92672">=</span> TweetListener(batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
    stream <span style="color:#f92672">=</span> Stream(auth<span style="color:#f92672">=</span>api<span style="color:#f92672">.</span>auth, listener<span style="color:#f92672">=</span>stream_listener)

    stream<span style="color:#f92672">.</span>filter(track<span style="color:#f92672">=</span>KEYWORDS)
</code></pre></div><p>The last part are <code>auth_twitter</code>, this function used to authenticate twitter apps using oauth. And the
most important part is the main method. The processes are authentication, create a stream listener, establish stream
session, and finally start the stream by filter with specific keywords/terms.</p>
<h2 id="running-the-code">Running the Code</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">(twitter<span style="color:#f92672">-</span>stream) <span style="color:#960050;background-color:#1e0010">➜</span>  twitter<span style="color:#f92672">-</span>stream pipenv run python twitter_stream<span style="color:#f92672">/</span>stream<span style="color:#f92672">.</span>py
Ini bukti dukungan masyarakat thdp penindakan koruptor yg dilakukan <span style="color:#a6e22e">@KPK_RI.</span> Maju terus KPK, rakyat mendukungmu<span style="color:#f92672">.</span>
https:<span style="color:#f92672">//</span>t<span style="color:#f92672">.</span>co<span style="color:#f92672">/</span>o2y1rMWDmN
<span style="color:#a6e22e">@ridwankamil</span> muhun kang sngt wajar<span style="color:#f92672">.</span> Ts lami masrakat cianjur trtindas ti jmn p cecep tp t walakaya, alhamdulillaah ihdinassirootol<span style="color:#f92672">-</span>mustaqiim
Empat kardus dan satu koper dibawa dari Disdik Cianjur <span style="color:#75715e">#ElshintaWeekend https://t.co/dX9BRJsmkI</span>
Proklamasi jilid <span style="color:#ae81ff">2</span> Kemerdekaan dari Korupsi<span style="color:#f92672">.</span>
Dampak Dari penangkapan <span style="color:#75715e">#Bupaticianjur Hampir semua yang berkaitan dengan &#34;Cianjur Jago&#34; dirusak &#34; bingung akutu :( https://t.co/gqRLDmsN6H</span>
Graduation Video
Universitas Putra Indonesia
Yayasan Pendidikan Yuyun Moeslim Taher
Cianjur,  tanggal <span style="color:#ae81ff">1</span> Desember <span style="color:#ae81ff">20</span><span style="color:#960050;background-color:#1e0010">…</span> https:<span style="color:#f92672">//</span>t<span style="color:#f92672">.</span>co<span style="color:#f92672">/</span>qTk4E5VNDr
</code></pre></div><p>if everything works, you&rsquo;ll see the tweets stream in your console. Please do ignore the tweets, I run it not in a good
time for <code>cianjur</code> keyword. Haha</p>

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "rizkidoank" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js" id="MathJax-script"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
      
        ©
        
        2020
         Rizki Rizki 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
        
      
    </section>
  </footer>

    </main>

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-78100671-2', 'auto');
	
	ga('send', 'pageview');
}
</script>


    

  </body>

</html>
